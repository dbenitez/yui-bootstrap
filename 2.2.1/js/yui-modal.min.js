(function(){YAHOO.namespace("bootstrap");var h=YAHOO,g=h.util,e=g.Dom,f=h.lang,d=g.Event,c=g.Selector,a=g.Connect;var b=function(j,i){this.options=i;this.$element=e.get(j);this.form=c.query(".modal-body form",this.$element,true)||null;d.on(c.query('[data-dismiss="modal"]',this.$element),"click",this.hide,this,true);this.options.remote&&this.loadRemote();this.showEvent=this.createEvent("show");this.shownEvent=this.createEvent("shown");this.hideEvent=this.createEvent("hide");this.hiddenEvent=this.createEvent("hidden");};b.prototype={defaults:{backdrop:true,keyboard:true,show:true},toggle:function(){YAHOO.log("toggle");return this[!this.isShown?"show":"hide"]();},show:function(){YAHOO.log("show");var i=this;this.fireEvent("show");if(this.isShown){return;}e.addClass(document.body,"modal-open");this.isShown=true;this.escape();this.backdrop(function(){var j=h.bootstrap.transition&&e.hasClass(i.$element,"fade");if(!i.$element.parentNode){document.body.appendChild(i.$element);}i.$element.style.display="";if(j){i.$element.offsetWidth;}e.removeClass(i.$element,"hide");e.addClass(i.$element,"in");i.$element.setAttribute("aria-hidden",false);i.$element.focus();i.enforceFocus();if(i.form){var k=c.query('input[type="text"]',i.$element,true);k&&k.focus();}j?d.on(i.$element,h.bootstrap.transition.end,function(){i.fireEvent("shown");d.removeListener(i.$element,h.bootstrap.transition.end);d.removeListener(i.$backdrop,h.bootstrap.transition.end);}):i.fireEvent("shown");});},hide:function(j){YAHOO.log("hide");j&&d.preventDefault(j);var i=this;this.fireEvent("hide");if(!this.isShown){return;}this.isShown=false;e.removeClass(document.body,"modal-open");this.escape();d.removeListener(document,"focusin");e.removeClass(this.$element,"in");this.$element.setAttribute("aria-hidden",true);h.bootstrap.transition&&e.hasClass(this.$element,"fade")?this.hideWithTransition():this.hideModal();},enforceFocus:function(){YAHOO.log("enforceFocus");var i=this;d.on(document,"focusin",function(j){if(i.$element!==j.target&&!e.isAncestor(i.$element,j.target)){i.$element.focus();}});},escape:function(){YAHOO.log("escape");var i=this;if(this.isShown&&this.options.keyboard){d.on(this.$element,"keyup",function(j){j.which==27&&i.hide();});}else{if(!this.isShown){d.removeListener(this.$element,"keyup");}}},hideWithTransition:function(){YAHOO.log("hideWithTransition");var i=this,j=setTimeout(function(){d.removeListener(i.$element,h.bootstrap.transition.end);i.hideModal();},500);d.on(this.$element,h.bootstrap.transition.end,function(){clearTimeout(j);i.hideModal();d.removeListener(i.$element,h.bootstrap.transition.end);});},hideModal:function(){YAHOO.log("hideModal");this.$element.style.display="none";this.fireEvent("hidden");this.backdrop();},removeBackdrop:function(){YAHOO.log("removeBackdrop");if(this.$backdrop){var i=this.$backdrop.parentNode||null;i&&i.removeChild(this.$backdrop);this.$backdrop=null;}},backdrop:function(l){YAHOO.log("backdrop");var k=this,j=e.hasClass(this.$element,"fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=h.bootstrap.transition&&j;this.$backdrop=document.createElement("div");this.$backdrop.className="modal-backdrop "+j;document.body.appendChild(this.$backdrop);if(this.options.backdrop!="static"){d.on(this.$backdrop,"click",this.hide,this,true);}if(i){this.$backdrop.offsetWidth;}e.addClass(this.$backdrop,"in");i?d.on(this.$backdrop,h.bootstrap.transition.end,l):l();}else{if(!this.isShown&&this.$backdrop){e.removeClass(this.$backdrop,"in");h.bootstrap.transition&&e.hasClass(this.$element,"fade")?d.on(this.$backdrop,h.bootstrap.transition.end,this.removeBackdrop,this,true):this.removeBackdrop();}else{if(l){l();}}}},loadRemote:function(){a.asyncRequest("GET",this.options.remote,{success:function(j){var i=e.getElementsByClassName("modal-body","div",this.self.$element)[0];i.innerHTML=j.responseText;},cache:false,self:this});}};b.multiple=function(j,i){!f.isArray(j)&&(j=[j]);return e.batch(j,function(l){var n=e.get(l),m=e.getData(n,"modal"),k=f.merge({},b.prototype.defaults,e.getData(n),(typeof i=="object")?i:{});if(!m){e.setData(n,"modal",(m=new b(l,k)));}if(typeof i=="string"){m[i]();}else{if(k.show){m.show();}}return m;});};f.augmentProto(b,g.EventProvider);YAHOO.bootstrap.Modal=b;d.onDOMReady(function(){var i=c.query('[data-toggle="modal"]',document.body);d.on(i,"click",function(n){var m=e.get(this),k=m.getAttribute("href"),j=c.query(m.getAttribute("data-target")||(k&&k.replace(/.*(?=#[^\s]+$)/,"")),document.body,true),l=e.getData(j,"modal")?"toggle":f.merge({remote:!/#/.test(k)&&k},e.getData(j)||{},e.getData(m)||{});d.preventDefault(n);b.multiple(j,l);d.on(j,"hide",function(){m.focus();});});});}());